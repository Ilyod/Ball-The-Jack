using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[RequireComponent(typeof(MeshFilter))]
[RequireComponent(typeof(MeshCollider))]
public class MeshGenerator : MonoBehaviour
{
    Mesh mesh;
    MeshCollider meshCollider;

    Vector3[] vertices;
    int[] triangles;

    private int xSize = 20;
    private int zSize = 22;

    private readonly float[,] yPerlinNoiseArray = { { 0.0f, 0.0f, 0.15167607261499946f, -0.005022375212814669f, -0.047399469278809093f, -0.03507081132983436f, 0.24017182894867617f, 0.11573499988476371f, -0.12881419938618166f, 0.06544410423739777f, -0.13206546092074256f, -0.038443944384025076f, -0.00693658732281141f, -0.02725099115809485f, 0.0106132268379823f, -0.0473610553809324f, 0.035359384137802694f, 0.06781080317435606f, -0.004414349669483219f, 0.15787169607296703f, -0.030587289534186733f, 0.0019995460968357526f, 0f }, { 0f, -0.4072136993558957f, -0.0733208879861816f, -0.02212997665586146f, -0.07038973744405402f, -0.3767254897587013f, -0.20755021942261256f, 0.0336211469150646f, -0.1457910679354348f, -0.021204195417435203f, -0.297654708681345f, -0.3032296656645366f, -0.4179947403316644f, -0.21337047874599815f, -0.24242569255235008f, -0.04497225370366709f, 0.14495298885753444f, 0.20995114385191932f, 0.16630159585140666f, 0.01878502791474087f, -0.19188919062107992f, 0.02091911678130031f, 0f }, { 0f, -0.04408755466522824f, 0.13417666943665463f, -0.011834927034301813f, 0.22143637856478748f, 0.026119399978435594f, -0.11490524072021968f, 0.10295754618726603f, 0.010153502148440713f, 0.13726684912147025f, -0.15824872146631125f, 0.08342749519115412f, -0.1926116952925981f, 0.02612901225577309f, -0.16247082529201426f, -0.11785688704748021f, 0.0668433508717153f, 0.07448537783859305f, 0.030824721565993977f, -0.022536865148042533f, 0.012660112384517613f, -0.007769810216075861f, 0f }, { 0f, 0.35725561894138486f, 0.30966960257442094f, 0.07243230336734345f, 0.198006171655365f, 0.0838074942921154f, -0.011124308571865707f, -0.21643449014972121f, -0.15360823301172571f, 0.31425073736377684f, 0.17800361889958072f, 0.24336719389011519f, 0.19362228987343877f, 0.3579395863942892f, 0.1278422909849471f, -0.16683203964901505f, -0.127881645514262f, -0.2226429527513666f, -0.1679873036528886f, -0.17545968757001362f, -0.21272343735249696f, -0.3230248645695353f, 0f }, { 0f, 0.05568846935266244f, -0.01287093803122745f, 0.027712888650758917f, -0.08450862978825047f, -0.15443439705909243f, 0.13708201379127855f, -0.03865752366847583f, 0.01819629159790069f, 0.02511237967244562f, 0.08805042826302008f, -0.14561246155289181f, 0.1821172004786689f, 0.1919748721199494f, -0.057865089293357694f, -0.027628980613878966f, 0.021616490305375633f, -0.18452097336849932f, 0.062378787061019715f, 0.10017852953542555f, -0.07944353749504933f, -0.06828878674090504f, 0f }, { 0f, -0.04956842490685537f, -0.1565960113833841f, -0.010806316401903021f, -0.010209241317523134f, 0.0789844531996371f, 0.3053449143144279f, 0.014532195655253467f, -0.0037108436672213013f, -0.25174805190490745f, -0.16114498131546012f, -0.14946662039828057f, 0.014651140173233806f, 0.05984385744672546f, -0.07322464610656164f, -0.23349618350851198f, -0.2563454887060752f, -0.3314566900519989f, -0.009602422995754553f, 0.3178125320053031f, 0.19725329627726623f, 0.05662981187152036f, 0f }, { 0f, 0.06321004979265203f, -0.2169417198502805f, 0.08009770907035035f, 0.013331786247343463f, -0.10324649550070884f, 0.1240686508285165f, -0.016710249666762867f, 0.03031784846747631f, -0.0028316042770584783f, 0.08365053497496898f, 0.05563186840960497f, -0.26655684619132736f, -0.14334951402180968f, 0.04170857465569879f, -0.05895632878215007f, -0.12041810408788739f, -0.29695376502526866f, 0.01872295604542778f, 0.3508306173977156f, -0.03236462048626969f, -0.4210346382233274f, 0f }, { 0f, -0.17342864101279046f, -0.4118274544314015f, -0.34310984442256065f, -0.27873999113087655f, 0.0757617044554984f, 0.25760267616322774f, -0.01432056449122478f, 0.05937094842081722f, 0.013772008562232096f, 0.11615029069503312f, 0.39085648742569634f, 0.21204052885845473f, -0.010389340579461559f, 0.0422552316417381f, 0.1799284612517878f, 0.1889530035380429f, 0.013439778907232566f, 0.27451288503303084f, 0.352402748133439f, -0.07644643279175939f, -0.22388404293264894f, 0f }, { 0f, -0.06617598147327229f, 0.19738453979503567f, -0.1569456580596636f, -0.5271309824186f, -0.025943069928333354f, 0.18455896633799812f, -0.0641618913692781f, 0.13384091523420116f, 0.09364420641110406f, 0.0013556845256634115f, -0.005979159573652824f, 0.37239623705651786f, 0.23089710837009986f, -0.03576665124013788f, 0.020252934607302f, 0.027500740255759475f, 0.01288769465462607f, 0.1507732063001879f, 0.047970173360584886f, -0.09055579186186832f, -0.03330906239301637f, 0f }, { 0f, -0.0005710493155553636f, 0.44832733386818785f, 0.2962438049717272f, -0.2423253146380099f, -0.1750661044212311f, 0.01243420847609567f, -0.011227048365451119f, 0.1631595689716963f, -0.14664899123722236f, -0.30045516869756345f, -0.4609087027395696f, -0.06803521141960933f, 0.17216866192061153f, -0.025179042640765065f, -0.04718478760276435f, -0.000314243940088078f, -0.16004997240704721f, -0.19957705700799414f, -0.004418716340967736f, 0.16076143949219118f, 0.21761506461953836f, 0f }, { 0f, -0.10981415225473665f, 0.18991234554112574f, 0.13098472875847067f, 0.09653144889843954f, -0.07942396404954323f, -0.3546094443250979f, -0.06200551685913384f, 0.291064821637047f, -0.11418459820799244f, -0.27295589403474096f, -0.30735888505134223f, -0.16683595008760646f, 0.16952064678556647f, 0.10577950047831404f, -0.15914926957696718f, 0.17322732817798986f, 0.2626549327677509f, -0.24960742828160487f, -0.37960363486237714f, 0.1267679427902857f, 0.016456885802923704f, 0f }, { 0f, 0.15144927557895793f, 0.18406773668615714f, -0.06324215412114677f, 0.10334160531034176f, 0.13293673245648757f, -0.245535863955694f, -0.21728951312724362f, 0.19984229621193725f, 0.24221858212253364f, 0.13926884826145836f, 0.21769828539287545f, 0.2614146107354664f, -0.03972762409525652f, -0.17012308296700562f, -0.32063049568621227f, 0.036545493191393746f, 0.48392072081998416f, 0.08271932890846735f, -0.35090292197981815f, 0.023862262773236186f, 0.059908982762689786f, 0f }, { 0f, 0.14673857711648086f, -0.19254367289575314f, -0.06435347784688948f, 0.05348556735335219f, -0.042522033495752815f, 0.11820012414156936f, -0.03885047158012224f, -0.19262485946007946f, 0.14239276319790323f, 0.12296545974332068f, 0.2573447067476451f, 0.30811351496162087f, 0.0592259480544239f, 0.18997747535485182f, -0.006518291465266578f, -0.17356316630280672f, 0.26969571913888213f, 0.16505981079253898f, -0.15081400211681228f, 0.15286224672360368f, 0.2338829420572563f, 0f }, { 0f, -0.041190382755210087f, -0.3093343628573086f, 0.005057481577675677f, 0.14280053453848376f, 0.056636867952226035f, 0.30862698389034215f, 0.1711029493167866f, -0.1514540190421523f, -0.053336012804199924f, -0.1301438969362421f, -0.20377235254409276f, -0.180107564438f, -0.293264228309633f, -0.045935098743196026f, 0.20333399503142674f, 0.03810657905823426f, 0.04168776429624595f, -0.18231979794583236f, -0.40353204441373713f, -0.06951961951535608f, 0.02003614620052282f, 0f }, { 0f, 0.09465958027934476f, 0.19068731742488618f, 0.15626456174724349f, 0.409150878104237f, 0.2946375819533386f, 0.08323124949436311f, 0.013321304568957928f, -0.021031427838924616f, 0.03421182120539654f, -0.18697291609549715f, -0.11113900260302825f, -0.3261854113409254f, -0.477009055143764f, -0.06251263461283224f, 0.18402777656439814f, -0.16797732197197476f, -0.01198199356523394f, -0.10792165931006578f, -0.3299470527911994f, 0.020793795272976357f, 0.08016856312851228f, 0f }, { 0f, -0.07479216778442238f, 0.0698122373530069f, -0.11076550675935322f, 0.14099005414619709f, -0.038766614166360534f, -0.2371376097395626f, 0.052330445251535886f, 0.10959786655511133f, 0.15652174048045023f, -0.08825397059819551f, 0.10295503140758881f, -0.14267918722365888f, -0.20691666404959816f, 0.24728081005277816f, 0.42066979007545857f, 0.00016188963594931656f, 0.04387474157040534f, -0.07321406928875315f, -0.3252214482794996f, -0.006780691258035279f, -0.07627717902452003f, 0f }, { 0f, -0.07631025702235188f, -0.2344930022217712f, -0.2325256079768275f, 0.03388347376914777f, -0.11906277864748138f, -0.13861235883483553f, 0.21858127496444962f, 0.2097588005381883f, 0.30255118590474456f, 0.11398443299342548f, 0.06474043642573021f, 0.281298819862868f, 0.13938335050405457f, -0.039513269560648656f, 0.30882423925136393f, 0.23989452085819357f, 0.15198116268686473f, 0.18990030932849167f, 0.1315711529174311f, -0.00992850377512534f, -0.09372784107839902f, 0f }, { 0f, -0.007956461157364085f, -0.19264791613172466f, 0.0007026034068210495f, 0.23982959684895847f, 0.041773186668759676f, -0.054403228036792185f, -0.028041571593787864f, -0.09392861263306007f, -0.057819232973355915f, -0.2090019770802424f, -0.2507881070596766f, 0.19976533528551899f, 0.3035926655220259f, -0.10876314899775673f, -0.0785648267734201f, -0.10993495773383123f, -0.18069897158946618f, -0.05125553694655737f, 0.16864719719404486f, -0.041686313982518736f, -0.15277002843824844f, 0f }, { 0f, -0.054240078954786074f, -0.24938191822436395f, -0.16656889406488035f, 0.10824866763092947f, 0.03689585851395548f, -0.2019588914048453f, -0.15973539658955527f, 0.03729840001241742f, -0.09545086287079899f, -0.28724391414195394f, -0.1424721509786933f, 0.10505355602036485f, 0.054022380546829535f, -0.23693895583660926f, -0.11315653632830959f, -0.02443399490626469f, 0.09030528056676218f, -0.05369905398540568f, 0.07359862354729065f, 0.13808454529258676f, -0.13131237055884903f, 0f }, { 0f, 0.006884499658226845f, -0.1040612917595907f, 0.021345132949948678f, 0.21613331147543352f, 0.047307653459717346f, -0.2457951166681057f, -0.11719963875593445f, 0.26118763716067517f, 0.11558027384850984f, -0.13270097981368703f, -0.08282348651769787f, 0.04933094206469793f, 0.14758193567603803f, -0.04156452214833906f, -0.08849364309242556f, 0.006027093499045461f, 0.21078918764347016f, -0.10382288788073689f, -0.1781372192772031f, -0.03789097372461977f, 0.04326722087125814f, 0f }, { 0f, 0.058765020140020566f, 0.1095914694127513f, 0.3490948466964015f, 0.5631589745422668f, 0.3329063207459746f, 0.02988373997604886f, 0.02795279200757525f, 0.10369125063469711f, 0.1674399925292238f, 0.034734327605607365f, -0.11205455057792138f, -0.021833273762680565f, 0.2601520988156765f, 0.256866695378457f, -0.03296481722749328f, -0.0950211215336569f, 0.21737226696939682f, 0.006210299883614719f, -0.15783142352090418f, -0.22826635776955004f, -0.05726502190180959f, 0f } };

    // Start is called before the first frame update
    void Start()
    {       
        mesh = new Mesh();
        GetComponent<MeshFilter>().mesh = mesh;
        meshCollider = gameObject.GetComponent<MeshCollider>();
        CreateShape();
        UpdateMesh();
    }

    void CreateShape()
    {
        vertices = new Vector3[(xSize + 1) * (zSize + 1)];

        for (int i = 0, z = 0; z <= zSize; z++)
        {
            for (int x = 0; x <= xSize; x++)
            {
                float y = yPerlinNoiseArray[x,z] * 2f;
                vertices[i] = new Vector3(x, y, z);
                i++;
            }
        }

        triangles = new int[xSize * zSize * 6];

        int vert = 0;
        int tris = 0;

        for (int z = 0; z < zSize; z++)
        {
            for (int x = 0; x < xSize; x++)
            {
                triangles[tris + 0] = vert + 0;
                triangles[tris + 1] = vert + xSize + 1;
                triangles[tris + 2] = vert + 1;
                triangles[tris + 3] = vert + 1;
                triangles[tris + 4] = vert + xSize + 1;
                triangles[tris + 5] = vert + xSize + 2;

                vert++;
                tris += 6;
            }
            vert++;
        }

    }

    void UpdateMesh()
    {
        mesh.Clear();
        mesh.vertices = vertices;
        mesh.triangles = triangles;
        mesh.RecalculateNormals();

        mesh.RecalculateBounds();
        meshCollider.sharedMesh = mesh;  
    }
}